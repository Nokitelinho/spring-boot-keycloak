# spring-boot-keycloak
Using spring boot and Keycloak authorization server

**1. Запускаем и настраиваем keycloak**

docker-compose up -d

Keycloak server control panel http://localhost:8484/auth/
Login: keycloak_admin
Password: admin_password 

2. Подключаем Keycloak при помощи адаптера (запустить модуль keycloak-adapter)
   <br><br>
   В официальной документации к keycloak для использования в приложениях рекомендуют использовать готовые библиотеки - адаптеры, которые дают возможность избавиться от boilerplate кода и излишнего конфигурирования. Есть реализация для большинства популярных языков и фреймворков. Мы будем использовать Spring Boot Adapter.
   <br><br>
   Пароль/Логин для админ авторизации: admin/admin <br>
   http://localhost:8080/api/admin <br>
   <br>
   Пароль/Логин для user авторизации: user/user <br>
   http://localhost:8080/api/user <br>
   <br>
   Документация <br>
   http://localhost:8080/swagger-ui/index.html?configUrl=/api-docs/swagger-config <br>
   <br>
3. Используем OAuth2 Client из spring-security

   Использование keycloak адаптера избавляет нас от написания кучи boilerplate кода. Но в то же время наше приложение становится зависимым от реализации. В некоторых случаях не стоит завязываться на какой-то конкретный сервис авторизации, это даст нам больше гибкости в дальнейшей эксплуатации системы.

   Одной из ключевых особенностей spring security 5 является поддержка протоколов OAuth2 и OIDC. Мы можем использовать OAuth2 клиент из пакета spring-security для интеграции с сервером keycloak.

4. Подключаем приложение как ResourceService

   Довольно часто не нужно, чтобы наше приложение инициировало аутентификацию пользователя. Достаточно лишь проверки авторизации пользователя по предоставляемому токену доступа. Вариантом подключения авторизации с keycloak без использования адаптера является настройка приложения как resource server. В этом случае приложение не может инициировать аутентификацию пользователя, а только авторизует пользователя и проверяет подпись токена доступа. Подключим соответствующие библиотеки: spring-security-oauth2-resource-server и spring-security-oauth2-jose
   
5. Авторизация вызовов сервисов с использованием keycloak

   При работе с  микросервисной архитектурой иногда возникают требования авторизованных вызовов между сервисами. В случаях, когда инициатором взаимодействия является какой-то внутренний процесс или служба, нам где-то нужно брать токен доступа. В качестве решения данного вопроса мы можем использовать Client Credentials Flow, чтобы получить токен из keycloak
